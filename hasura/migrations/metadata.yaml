version: 2
tables:
- table:
    schema: public
    name: daily_task_notes
- table:
    schema: public
    name: daily_tasks
- table:
    schema: public
    name: designations
  is_enum: true
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - id
      - name
      filter: {}
- table:
    schema: public
    name: employees
  object_relationships:
  - name: designation
    using:
      foreign_key_constraint_on: designation_id
  - name: organization
    using:
      foreign_key_constraint_on: organization_id
  array_relationships:
  - name: team_members
    using:
      manual_configuration:
        remote_table:
          schema: public
          name: team_members
        column_mapping:
          ecode: ecode
          organization_id: organization_id
  insert_permissions:
  - role: app_admin
    permission:
      check: {}
      columns:
      - designation_id
      - ecode
      - email
      - headshot
      - joining_date
      - name
      - organization_id
      - relieving_date
      backend_only: false
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - joining_date
      - relieving_date
      - designation_id
      - ecode
      - email
      - headshot
      - name
      - created_at
      - updated_at
      - organization_id
      - user_id
      filter: {}
      allow_aggregations: true
  - role: user
    permission:
      columns:
      - created_at
      - designation_id
      - ecode
      - email
      - headshot
      - joining_date
      - name
      - organization_id
      - relieving_date
      - updated_at
      - user_id
      filter:
        organization_id:
          _eq: X-Hasura-Organization-Id
  update_permissions:
  - role: app_admin
    permission:
      columns:
      - designation_id
      - ecode
      - email
      - headshot
      - joining_date
      - name
      - organization_id
      - relieving_date
      filter: {}
      check: null
  delete_permissions:
  - role: app_admin
    permission:
      filter: {}
  event_triggers:
  - name: create_user_for_new_employee
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook_from_env: NEW_EMPLOYEE_WEBHOOK
- table:
    schema: public
    name: me
  object_relationships:
  - name: role
    using:
      manual_configuration:
        remote_table:
          schema: public
          name: roles
        column_mapping:
          role_id: id
  array_relationships:
  - name: as_employee
    using:
      manual_configuration:
        remote_table:
          schema: public
          name: employees
        column_mapping:
          id: user_id
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - avatar
      - email
      - name
      - role_id
      - created_at
      - updated_at
      - created_by
      - id
      filter:
        id:
          _eq: X-Hasura-User-Id
  - role: user
    permission:
      columns:
      - avatar
      - email
      - name
      - role_id
      - created_at
      - updated_at
      - created_by
      - id
      filter:
        id:
          _eq: X-Hasura-User-Id
      limit: 1
- table:
    schema: public
    name: organizations
  array_relationships:
  - name: employees
    using:
      foreign_key_constraint_on:
        column: organization_id
        table:
          schema: public
          name: employees
  - name: projects
    using:
      foreign_key_constraint_on:
        column: organization_id
        table:
          schema: public
          name: projects
  computed_fields:
  - name: is_current
    definition:
      function:
        schema: public
        name: is_current_organization
      session_argument: hasura_session
      table_argument: organizations_row
  insert_permissions:
  - role: app_admin
    permission:
      check: {}
      columns:
      - square_logo
      - banner
      - name
      backend_only: false
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - name
      - square_logo
      - created_at
      - updated_at
      - id
      - banner
      computed_fields:
      - is_current
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - name
      - square_logo
      - banner
      computed_fields:
      - is_current
      filter:
        employees:
          user_id:
            _eq: X-Hasura-User-Id
      allow_aggregations: true
  update_permissions:
  - role: app_admin
    permission:
      columns:
      - square_logo
      - banner
      - name
      filter: {}
      check: {}
- table:
    schema: public
    name: projects
  object_relationships:
  - name: organization
    using:
      foreign_key_constraint_on: organization_id
  array_relationships:
  - name: teams
    using:
      foreign_key_constraint_on:
        column: project_id
        table:
          schema: public
          name: teams
  insert_permissions:
  - role: app_admin
    permission:
      check: {}
      set:
        created_by: x-hasura-User-Id
      columns:
      - description
      - issue_link_template
      - logo
      - logo_square
      - name
      - organization_id
      - pr_link_template
      backend_only: false
  - role: user
    permission:
      check:
        organization:
          employees:
            user_id:
              _eq: X-Hasura-User-Id
      set:
        created_by: x-hasura-User-Id
      columns:
      - id
      - name
      - logo
      - logo_square
      - description
      - organization_id
      - issue_link_template
      - pr_link_template
      - created_at
      - updated_at
      backend_only: false
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - description
      - issue_link_template
      - logo
      - logo_square
      - name
      - pr_link_template
      - created_at
      - updated_at
      - id
      - organization_id
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - name
      - logo
      - logo_square
      - description
      - organization_id
      - issue_link_template
      - pr_link_template
      - created_at
      - updated_at
      filter:
        teams:
          members:
            employee:
              user_id:
                _eq: X-Hasura-User-Id
  update_permissions:
  - role: app_admin
    permission:
      columns:
      - description
      - issue_link_template
      - logo
      - logo_square
      - name
      - organization_id
      - pr_link_template
      filter: {}
      check: null
  delete_permissions:
  - role: app_admin
    permission:
      filter: {}
  event_triggers:
  - name: create_team_for_new_project
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook_from_env: NEW_PROJECT_WEBHOOK
- table:
    schema: public
    name: roles
  is_enum: true
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - id
      - name
      filter: {}
  - role: user
    permission:
      columns:
      - id
      - name
      filter: {}
- table:
    schema: public
    name: team_members
  object_relationships:
  - name: employee
    using:
      manual_configuration:
        remote_table:
          schema: public
          name: employees
        column_mapping:
          ecode: ecode
          organization_id: organization_id
  - name: team
    using:
      foreign_key_constraint_on: team_id
  insert_permissions:
  - role: app_admin
    permission:
      check: {}
      columns:
      - ecode
      - organization_id
      - team_id
      backend_only: false
  - role: user
    permission:
      check: {}
      columns:
      - ecode
      - organization_id
      - team_id
      backend_only: false
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - ecode
      - created_at
      - updated_at
      - organization_id
      - team_id
      filter: {}
  - role: user
    permission:
      columns:
      - ecode
      - team_id
      - created_at
      - updated_at
      - organization_id
      filter: {}
  update_permissions:
  - role: app_admin
    permission:
      columns:
      - ecode
      - organization_id
      - team_id
      filter: {}
      check: null
  - role: user
    permission:
      columns:
      - ecode
      - organization_id
      - team_id
      filter: {}
      check: {}
  delete_permissions:
  - role: app_admin
    permission:
      filter: {}
  - role: user
    permission:
      filter: {}
- table:
    schema: public
    name: teams
  object_relationships:
  - name: project
    using:
      foreign_key_constraint_on: project_id
  array_relationships:
  - name: members
    using:
      foreign_key_constraint_on:
        column: team_id
        table:
          schema: public
          name: team_members
  insert_permissions:
  - role: app_admin
    permission:
      check: {}
      columns:
      - issue_link_template
      - logo
      - logo_square
      - name
      - pr_link_template
      - project_id
      backend_only: false
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - issue_link_template
      - logo
      - logo_square
      - name
      - pr_link_template
      - created_at
      - updated_at
      - id
      - project_id
      filter: {}
      allow_aggregations: true
  - role: user
    permission:
      columns:
      - id
      - name
      - logo
      - logo_square
      - issue_link_template
      - pr_link_template
      - project_id
      - created_at
      - updated_at
      filter:
        project:
          teams:
            members:
              employee:
                user_id:
                  _eq: X-Hasura-User-Id
      allow_aggregations: true
  update_permissions:
  - role: app_admin
    permission:
      columns:
      - issue_link_template
      - logo
      - logo_square
      - name
      - pr_link_template
      - project_id
      filter: {}
      check: {}
  delete_permissions:
  - role: app_admin
    permission:
      filter: {}
- table:
    schema: public
    name: user_logins
- table:
    schema: public
    name: users
  object_relationships:
  - name: role
    using:
      foreign_key_constraint_on: role_id
  array_relationships:
  - name: as_employee
    using:
      foreign_key_constraint_on:
        column: user_id
        table:
          schema: public
          name: employees
  select_permissions:
  - role: app_admin
    permission:
      columns:
      - id
      - name
      - avatar
      - email
      - created_by
      - created_at
      - updated_at
      - role_id
      filter: {}
  - role: user
    permission:
      columns:
      - avatar
      - created_at
      - email
      - id
      - name
      - role_id
      - updated_at
      filter:
        id:
          _eq: X-Hasura-User-Id
      limit: 1
  event_triggers:
  - name: default_user_login
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      num_retries: 0
      interval_sec: 10
      timeout_sec: 60
    webhook_from_env: NEW_USER_WEBHOOK
remote_schemas:
- name: sidecar
  definition:
    url_from_env: SIDECAR_GRAPHQL_URL
    timeout_seconds: 60
    forward_client_headers: true
